<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>DEX-CEX Arbitrage</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .profit-pos { color: green; font-weight: bold; }
    .profit-neg { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>üìä Arbitrage Monitor</h1>
  <table id="arbitrage-table">
    <thead>
      <tr>
        <th>–¢–æ–∫–µ–Ω</th>
        <th>ODOS —Ü–µ–Ω–∞</th>
        <th>MEXC —Ü–µ–Ω–∞</th>
        <th>–°–ø—Ä–µ–¥ (%)</th>
        <th>–ü—Ä–∏–±—ã–ª—å (USDT)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
async function loadPrices() {
  try {
    const res = await fetch("/prices");
    const data = await res.json();

    const tbody = document.querySelector("#arbitrage-table tbody");
    tbody.innerHTML = "";

    for (const token of Object.keys(data.odos)) {
      const odosPrice = data.odos[token];
      const mexcPrice = data.mexc[token];
      const spread = data.spread[token];
      const profit = data.profit[token];

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${token}</td>
        <td>${odosPrice !== null ? odosPrice.toFixed(6) : "-"}</td>
        <td>${mexcPrice !== null ? mexcPrice.toFixed(6) : "-"}</td>
        <td>${spread !== null ? spread.toFixed(2) : "-"}%</td>
        <td>${profit !== null ? (profit > 0 ? `<span class="profit-pos">+${profit.toFixed(4)}</span>` :
                                    `<span class="profit-neg">${profit.toFixed(4)}</span>`) : "-"}</td>
      `;
      tbody.appendChild(row);
    }
  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ü–µ–Ω:", err);
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
loadPrices();
setInterval(loadPrices, 10000);
</script>
</body>
</html>
